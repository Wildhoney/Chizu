<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chizu Dispatch Relationships</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          sans-serif;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        min-height: 100vh;
        padding: 2rem;
        color: #e0e0e0;
      }
      h1 {
        text-align: center;
        margin-bottom: 1rem;
        color: #fff;
        font-size: 2rem;
        font-weight: 600;
      }
      .subtitle {
        text-align: center;
        color: #888;
        margin-bottom: 2rem;
        font-size: 0.95rem;
      }
      .mermaid {
        background: #fff;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 1400px;
        margin: 0 auto 2rem;
        overflow-x: auto;
      }
      .legend {
        max-width: 1400px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
      }
      .legend-item {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        padding: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .legend-item h3 {
        font-size: 0.85rem;
        color: #fff;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .legend-item p {
        font-size: 0.8rem;
        color: #aaa;
        line-height: 1.5;
      }
      .dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
      }
      .dot-unicast {
        background: #e1f5fe;
        border: 2px solid #01579b;
      }
      .dot-broadcast {
        background: #fff3e0;
        border: 2px solid #e65100;
      }
      .dot-lifecycle {
        background: #f3e5f5;
        border: 2px solid #7b1fa2;
      }
      .dot-interaction {
        background: #e8f5e9;
        border: 2px solid #2e7d32;
      }
      .dot-model {
        background: #fce4ec;
        border: 2px solid #c2185b;
      }
      .dot-consumer {
        background: #fff8e1;
        border: 2px solid #ff8f00;
      }
    </style>
  </head>
  <body>
    <h1>Chizu Dispatch Relationships</h1>
    <p class="subtitle">
      Action flow visualization for the example application
    </p>

    <div class="mermaid">
      flowchart TB subgraph Lifecycle["ðŸ”„ Lifecycle Actions (System)"]
      Mount["Lifecycle.Mount"] Node["Lifecycle.Node"]
      Unmount["Lifecycle.Unmount"] Error["Lifecycle.Error"] end subgraph
      CounterComponent["ðŸ“Š Counter Component"] subgraph CounterActions["Unicast
      Actions"] Increment["Actions.Increment"] Decrement["Actions.Decrement"]
      end IncrementBtn["âž• Increment Button"] DecrementBtn["âž– Decrement
      Button"] CounterModel["model.count"] end subgraph VisitorComponent["ðŸ‘¤
      Visitor Component"] subgraph VisitorActions["Unicast Actions"]
      Visitor["Actions.Visitor"] end EventSource["EventSource 'visitor'"]
      VisitorModel["model.visitor"] end subgraph Broadcast["ðŸ“¡ Broadcast
      Channel"] DistributedCounter["DistributedActions.Counter"] end subgraph
      Consumption["ðŸŽ¯ Consumers"] VisitorConsume["actions.consume()"]
      PartitionRender["Partition Component"] end %% User interactions
      IncrementBtn -->|"dispatch()"| Increment DecrementBtn -->|"dispatch()"|
      Decrement %% Counter action handlers Increment -->|"produce()"|
      CounterModel Decrement -->|"produce()"| CounterModel %% Counter broadcasts
      to distributed Increment -->|"dispatch()"| DistributedCounter Decrement
      -->|"dispatch()"| DistributedCounter %% Lifecycle triggers visitor Mount
      -->|"triggers"| EventSource EventSource -->|"dispatch()"| Visitor Visitor
      -->|"Bound('visitor')"| VisitorModel %% Broadcast consumption
      DistributedCounter -->|"subscribe"| VisitorConsume VisitorConsume -->
      PartitionRender %% Lifecycle connections Mount -.->|"component mounts"|
      CounterComponent Mount -.->|"component mounts"| VisitorComponent Node
      -.->|"after render"| CounterComponent Node -.->|"after render"|
      VisitorComponent Unmount -.->|"cleanup"| CounterComponent Unmount
      -.->|"cleanup"| VisitorComponent Error -.->|"handler error"|
      CounterComponent Error -.->|"handler error"| VisitorComponent %% Styling
      classDef unicast fill:#e1f5fe,stroke:#01579b,color:#01579b classDef
      broadcast fill:#fff3e0,stroke:#e65100,color:#e65100 classDef lifecycle
      fill:#f3e5f5,stroke:#7b1fa2,color:#7b1fa2 classDef interaction
      fill:#e8f5e9,stroke:#2e7d32,color:#2e7d32 classDef model
      fill:#fce4ec,stroke:#c2185b,color:#c2185b classDef consumer
      fill:#fff8e1,stroke:#ff8f00,color:#ff8f00 class
      Increment,Decrement,Visitor unicast class DistributedCounter broadcast
      class Mount,Node,Unmount,Error lifecycle class
      IncrementBtn,DecrementBtn,EventSource interaction class
      CounterModel,VisitorModel model class VisitorConsume,PartitionRender
      consumer
    </div>

    <div class="legend">
      <div class="legend-item">
        <h3><span class="dot dot-lifecycle"></span> Lifecycle Actions</h3>
        <p>
          System-provided actions triggered automatically: Mount, Node, Unmount,
          and Error handling.
        </p>
      </div>
      <div class="legend-item">
        <h3><span class="dot dot-unicast"></span> Unicast Actions</h3>
        <p>
          Component-local actions dispatched via per-component EventEmitter.
          Only handled within the defining component.
        </p>
      </div>
      <div class="legend-item">
        <h3><span class="dot dot-broadcast"></span> Broadcast Actions</h3>
        <p>
          Cross-component actions using shared EventEmitter3. Enables state
          sharing between components.
        </p>
      </div>
      <div class="legend-item">
        <h3><span class="dot dot-interaction"></span> User Interactions</h3>
        <p>
          Entry points for dispatches: button clicks, EventSource connections,
          and other user-triggered events.
        </p>
      </div>
      <div class="legend-item">
        <h3><span class="dot dot-model"></span> Model State</h3>
        <p>
          Component state updated via produce() in action handlers using
          Immer-style mutations.
        </p>
      </div>
      <div class="legend-item">
        <h3><span class="dot dot-consumer"></span> Consumers</h3>
        <p>
          Components subscribing to broadcast actions via actions.consume() for
          reactive rendering.
        </p>
      </div>
    </div>

    <script>
      mermaid.initialize({
        startOnLoad: true,
        theme: "default",
        flowchart: {
          useMaxWidth: true,
          htmlLabels: true,
          curve: "basis",
        },
      });
    </script>
  </body>
</html>
